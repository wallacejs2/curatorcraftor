<!DOCTYPE html>
<html>
  <head>
    <title>Craftor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20,400,0,0" />
    <link rel="stylesheet" href="./index.css">
    <style>
      .add-component-trigger {
        width: 100%;
        padding: var(--spacing-lg);
        border: 2px dashed var(--separator-primary);
        border-radius: var(--radius-lg);
        background: transparent;
        color: var(--label-secondary);
        font-family: inherit;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-base);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
      }

      .add-component-trigger:hover {
        background: var(--background-secondary);
        border-color: var(--system-blue);
        color: var(--system-blue);
      }

      .components-container {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .component-item {
        position: relative;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .picker-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-md);
        padding: var(--spacing-lg);
      }

      .picker-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-lg);
        background: var(--background-secondary);
        border: 1px solid var(--separator-secondary);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-base);
      }

      .picker-option:hover {
        background: var(--background-primary);
        border-color: var(--system-blue);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .picker-option svg {
        color: var(--system-blue);
      }

      .picker-option span {
        font-weight: 600;
        font-size: 13px;
        color: var(--label-primary);
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "dompurify": "https://esm.sh/dompurify@^3.0.6"
  }
}
</script>
</head>
  <body>
    <!-- Design Customization Sidebar (Left) -->
    <aside id="design-sidebar" class="design-sidebar">
      <div class="sidebar-header">
        <h3 class="text-xl">Design Customization</h3>
        <button type="button" id="close-design-sidebar" class="btn btn-secondary btn-sm" style="width: 24px; height: 24px; padding: 0; border-radius: 50%;">&times;</button>
      </div>
      <div class="sidebar-content">
        <!-- Font Selection -->
        <div class="design-option-group">
          <h4>Email Font</h4>
          <select id="design-font-family" name="design-font-family" class="form-control">
            <option value="'Arial', sans-serif">Arial</option>
            <option value="'Courier New', Courier, monospace">Courier New</option>
            <option value="'Georgia', serif">Georgia</option>
            <option value="'Helvetica', sans-serif">Helvetica</option>
            <option value="'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', sans-serif">Lucida Sans</option>
            <option value="'Tahoma', sans-serif">Tahoma</option>
            <option value="'Times New Roman', Times, serif">Times New Roman</option>
            <option value="'Trebuchet MS', 'Helvetica', sans-serif">Trebuchet MS</option>
            <option value="'Verdana', sans-serif">Verdana</option>
          </select>
        </div>

        <!-- Color Scheme -->
        <div class="design-option-group" id="global-text-styles">
          <h4>Color Scheme</h4>
          <div class="color-scheme-grid" id="color-scheme-grid">
            <!-- cards injected by initGlobalTextStyles() -->
          </div>
        </div>

        <!-- Dynamic Field Styling Container -->
        <div id="dynamic-styling-container"></div>

      </div>
    </aside>

    <div class="main-content-area">
      <header class="mobile-header">
        <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="Open design menu">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <h1 class="mobile-header-title">Craftor</h1>
      </header>
      <div class="container">
        <main>
          <section class="hero">
            <h1 class="text-6xl hero-title">Craftor</h1>
            <p class="text-lg hero-subtitle">
              Automotive Email Builder: Create, customize, and conquer.
            </p>
            <div id="dealership-banner-container"></div>
          </section>

          <section class="card mb-6">
            <div class="card-header card-header--two-row">
              <div class="card-header-top">
                <h2 class="text-2xl">Customize Your Email</h2>
                <div class="flex items-center gap-2">
                  <button type="button" id="collapse-all-btn" class="btn btn-ghost btn-icon" data-tooltip="Collapse All">
                    <span class="material-symbols-rounded">collapse_all</span>
                  </button>
                  <button type="button" id="expand-all-btn" class="btn btn-ghost btn-icon" data-tooltip="Expand All">
                    <span class="material-symbols-rounded">expand_all</span>
                  </button>
                </div>
              </div>
              <div class="card-header-quickadd">
                <div class="quickadd-actions">
                  <button type="button" id="delete-all-btn" class="quickadd-btn quickadd-btn--danger" data-tooltip="Delete All Sections">
                    <span class="material-symbols-rounded">delete_sweep</span>
                  </button>
                  <button type="button" id="reset-all-btn" class="quickadd-btn quickadd-btn--warning" data-tooltip="Reset All Styles">
                    <span class="material-symbols-rounded">format_clear</span>
                  </button>
                  <button type="button" id="clear-all-btn" class="quickadd-btn quickadd-btn--warning" data-tooltip="Clear All Content">
                    <span class="material-symbols-rounded">clear_all</span>
                  </button>
                  <button type="button" id="quick-save-btn" class="quickadd-btn quickadd-btn--save" data-tooltip="Save Template">
                    <span class="material-symbols-rounded">save</span>
                  </button>
                </div>
                <span class="quickadd-divider"></span>
                <span class="quickadd-label">Add</span>
                <div class="quickadd-icons">
                  <button type="button" class="quickadd-btn" data-type="header" data-tooltip="Header">
                    <span class="material-symbols-rounded">format_h1</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="text_block" data-tooltip="Text Block">
                    <span class="material-symbols-rounded">format_align_justify</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="image" data-tooltip="Image">
                    <span class="material-symbols-rounded">image</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="button" data-tooltip="Button">
                    <span class="material-symbols-rounded">radio_button_checked</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="footer" data-tooltip="Footer">
                    <span class="material-symbols-rounded">link</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="divider" data-tooltip="Divider">
                    <span class="material-symbols-rounded">horizontal_rule</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="spacer" data-tooltip="Spacer">
                    <span class="material-symbols-rounded">expand_all</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="disclaimers" data-tooltip="Disclaimers">
                    <span class="material-symbols-rounded">contract</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="service_offer" data-tooltip="Service Offer">
                    <span class="material-symbols-rounded">handyman</span>
                  </button>
                  <button type="button" class="quickadd-btn" data-type="sales_offer" data-tooltip="Sales Offer">
                    <span class="material-symbols-rounded">sell</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <form id="email-form">
                <div id="form-components-container" class="components-container">
                  <!-- Dynamic form components will be injected here -->
                </div>

                <button type="button" id="add-component-btn" class="add-component-trigger">
                  <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  Add Section
                </button>

                <button type="submit" id="generate-btn" class="btn btn-primary w-full" style="margin-top: var(--spacing-2xl);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="checkmark hidden"><path d="M20 6 9 17l-5-5"></path></svg>
                  <span class="btn-text">Generate Template</span>
                  <div class="spinner hidden"></div>
                </button>
              </form>
            </div>
          </section>

          <section class="grid grid-cols-1" id="output-container" style="display: none;">
            <div class="card">
              <div class="card-header">
                <h3 class="text-xl">Preview</h3>
                <div class="flex gap-2" style="align-items: center;">
                  <div class="toggle-group">
                    <button id="desktop-view-btn" class="toggle-btn active" data-view="desktop">Desktop</button>
                    <button id="mobile-view-btn" class="toggle-btn" data-view="mobile">Mobile</button>
                  </div>
                  <button id="download-btn" class="btn btn-secondary btn-sm">Download HTML</button>
                  <button id="download-pdf-btn" class="btn btn-secondary btn-sm">Download PDF</button>
                  <button id="copy-btn" class="btn btn-primary btn-sm">Copy HTML</button>
                </div>
              </div>
              <div class="preview-container">
                <iframe id="preview-pane" title="Email Preview" class="preview-frame desktop" sandbox="allow-same-origin"></iframe>
              </div>
            </div>
            <div style="display:none;"><pre><code id="code-block"></code></pre></div>
          </section>

          <section class="card" id="output-placeholder">
            <div class="card-body" style="text-align: center; padding: var(--spacing-3xl);">
              <p class="text-lg" style="color: var(--label-secondary);">Your generated email will appear here.</p>
            </div>
          </section>

          <footer style="text-align: center; margin-top: var(--spacing-3xl); color: var(--label-secondary);">
            <p class="text-sm">Created by Jayden Wallace Â© 2025</p>
          </footer>
        </main>
      </div>
    </div>
    
    <!-- Right Side Panel: Templates & Component Library -->
    <aside id="right-panel" class="right-panel">
      <div class="right-panel-header">
        <div class="right-panel-tabs">
          <button type="button" class="right-panel-tab active" data-tab="templates">Templates</button>
          <button type="button" class="right-panel-tab" data-tab="library"><span class="material-symbols-rounded" style="font-size: 16px; vertical-align: middle; margin-right: 2px;">bookmark</span> Library</button>
        </div>
        <button type="button" id="close-right-panel" class="btn btn-secondary btn-sm" style="width: 24px; height: 24px; padding: 0; border-radius: 50%;">&times;</button>
      </div>
      <div class="right-panel-content">
        <!-- Templates Tab -->
        <div id="right-panel-templates" class="right-panel-tab-content active">
          <div style="padding: 0 0 var(--spacing-md) 0;">
            <button type="button" id="save-template-btn" class="btn btn-primary w-full btn-sm">
              Save Current Template
            </button>
          </div>
          <!-- Starter Templates -->
          <div class="starter-section">
            <h4 class="starter-section-title">Starter Templates</h4>
            <div class="starter-grid">
              <button type="button" class="starter-card" data-starter-template="single_offer">
                <span class="material-symbols-rounded starter-card-icon">sell</span>
                <span class="starter-card-label">Single Offer</span>
              </button>
              <button type="button" class="starter-card" data-starter-template="two_column_offers">
                <span class="material-symbols-rounded starter-card-icon">view_column_2</span>
                <span class="starter-card-label">2-Column Offers</span>
              </button>
              <button type="button" class="starter-card" data-starter-template="service_and_sales">
                <span class="material-symbols-rounded starter-card-icon">handyman</span>
                <span class="starter-card-label">Service + Sales</span>
              </button>
              <button type="button" class="starter-card" data-starter-template="recall_notice">
                <span class="material-symbols-rounded starter-card-icon">warning</span>
                <span class="starter-card-label">Recall Notice</span>
              </button>
            </div>
          </div>
          <!-- Saved Templates: search / filter / sort toolbar -->
          <div id="template-controls"></div>
          <!-- Saved Templates list -->
          <div id="saved-templates-list"></div>
        </div>
        <!-- Component Library Tab -->
        <div id="right-panel-library" class="right-panel-tab-content">
          <!-- Starter Components -->
          <div class="starter-section">
            <h4 class="starter-section-title">Starter Components</h4>
            <div class="starter-grid">
              <button type="button" class="starter-card" data-starter-component="hero_header">
                <span class="material-symbols-rounded starter-card-icon">format_h1</span>
                <span class="starter-card-label">Hero Header</span>
              </button>
              <button type="button" class="starter-card" data-starter-component="service_coupon">
                <span class="material-symbols-rounded starter-card-icon">handyman</span>
                <span class="starter-card-label">Service Coupon</span>
              </button>
              <button type="button" class="starter-card" data-starter-component="vehicle_offer">
                <span class="material-symbols-rounded starter-card-icon">sell</span>
                <span class="starter-card-label">Vehicle Offer</span>
              </button>
              <button type="button" class="starter-card" data-starter-component="cta_button">
                <span class="material-symbols-rounded starter-card-icon">radio_button_checked</span>
                <span class="starter-card-label">CTA Button</span>
              </button>
            </div>
          </div>
          <!-- Saved Components -->
          <div id="library-filter-bar"></div>
          <div id="component-library-list">
            <p class="text-sm" style="color: var(--label-secondary); text-align: center;">No saved components. Use the <span class="material-symbols-rounded" style="font-size: 14px; vertical-align: middle;">bookmark</span> icon on any section to add it to your library.</p>
          </div>
        </div>
      </div>
    </aside>
    <div id="right-panel-overlay" class="sidebar-overlay"></div>

    <div id="design-sidebar-overlay" class="sidebar-overlay"></div>
    <!-- Merge Fields Sidebar (Right) -->
    <div id="merge-fields-sidebar" class="merge-fields-sidebar">
      <div class="sidebar-header">
        <h3 class="text-xl">Insert Merge Field</h3>
        <button type="button" id="close-sidebar" class="btn btn-secondary btn-sm" style="width: 24px; height: 24px; padding: 0; border-radius: 50%;">&times;</button>
      </div>
      <div class="sidebar-content">
        <!-- Content generated by JS -->
      </div>
    </div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Component Selection Modal -->
    <div id="component-picker-overlay" class="quick-picker-overlay">
      <div class="quick-picker-modal">
        <div class="quick-picker-header">
          <h3 class="text-xl">Select a Component</h3>
          <button type="button" id="close-component-picker" class="btn btn-secondary btn-sm" style="width: 24px; height: 24px; padding: 0; border-radius: 50%;">&times;</button>
        </div>
        <div class="quick-picker-content">
           <div class="picker-grid">
             <div class="picker-option" data-type="header">
               <span class="material-symbols-rounded picker-icon">format_h1</span>
               <span>Header</span>
             </div>
             <div class="picker-option" data-type="text_block">
               <span class="material-symbols-rounded picker-icon">format_align_justify</span>
               <span>Text Block</span>
             </div>
             <div class="picker-option" data-type="image">
               <span class="material-symbols-rounded picker-icon">image</span>
               <span>Image</span>
             </div>
             <div class="picker-option" data-type="button">
               <span class="material-symbols-rounded picker-icon">radio_button_checked</span>
               <span>Button</span>
             </div>
             <div class="picker-option" data-type="footer">
               <span class="material-symbols-rounded picker-icon">link</span>
               <span>Footer</span>
             </div>
             <div class="picker-option" data-type="divider">
               <span class="material-symbols-rounded picker-icon">horizontal_rule</span>
               <span>Divider</span>
             </div>
             <div class="picker-option" data-type="spacer">
               <span class="material-symbols-rounded picker-icon">expand_all</span>
               <span>Spacer</span>
             </div>
             <div class="picker-option" data-type="disclaimers">
               <span class="material-symbols-rounded picker-icon">contract</span>
               <span>Disclaimers</span>
             </div>
             <div class="picker-option" data-type="service_offer">
               <span class="material-symbols-rounded picker-icon">handyman</span>
               <span>Service Offer</span>
             </div>
             <div class="picker-option" data-type="sales_offer">
               <span class="material-symbols-rounded picker-icon">sell</span>
               <span>Sales Offer</span>
             </div>
           </div>
        </div>
      </div>
    </div>


    <!-- Floating Action Buttons -->
    <button type="button" id="floating-panel-btn" class="fab fab-panel" data-tooltip="Templates & Library">
      <span class="material-symbols-rounded" style="font-size: 22px;">bookmark</span>
    </button>
    <button type="button" id="floating-merge-btn" class="fab fab-merge" data-tooltip="Insert Merge Fields">
      <span style="font-family: var(--font-family-mono); font-size: 16px; font-weight: bold;">{{}}</span>
    </button>
    
    <div id="autocomplete-dropdown"></div>

    <!-- Dealership Manager Modal -->
    <div id="dealership-modal" class="dealership-modal-overlay">
      <div class="dealership-modal-container">
        <div class="dealership-modal-header">
          <h3 class="text-xl">Dealership Groups</h3>
          <button type="button" id="close-dealership-modal" class="btn btn-secondary btn-sm" style="width: 24px; height: 24px; padding: 0; border-radius: 50%;">&times;</button>
        </div>
        <div id="dealership-modal-body" class="dealership-modal-body">
          <!-- Dynamically rendered by JS -->
        </div>
      </div>
    </div>

    <!-- Save Template Modal -->
    <div id="save-template-modal" class="quick-picker-overlay">
      <div class="quick-picker-modal save-modal">
        <div class="quick-picker-header">
          <h3 class="text-xl">Save Template</h3>
          <button type="button" id="close-save-template-modal" class="btn btn-secondary btn-sm" style="width:24px;height:24px;padding:0;border-radius:50%;">&times;</button>
        </div>
        <div class="save-modal-body">
          <div class="form-group">
            <label class="form-label">Template Name</label>
            <input type="text" id="save-template-name-input" class="form-control" placeholder="e.g. Monthly Oil Change Promo">
          </div>
          <div class="form-group" style="margin-top:var(--spacing-md);">
            <label class="form-label">Save In</label>
            <div id="save-template-assign-list" class="save-assign-list"></div>
          </div>
        </div>
        <div class="save-modal-footer">
          <button type="button" class="btn btn-primary flex-1" id="confirm-save-template">Save Template</button>
          <button type="button" class="btn btn-ghost" id="cancel-save-template">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Save Component Modal -->
    <div id="save-component-modal" class="quick-picker-overlay">
      <div class="quick-picker-modal save-modal">
        <div class="quick-picker-header">
          <h3 class="text-xl">Save to Library</h3>
          <button type="button" id="close-save-component-modal" class="btn btn-secondary btn-sm" style="width:24px;height:24px;padding:0;border-radius:50%;">&times;</button>
        </div>
        <div class="save-modal-body">
          <div class="form-group">
            <label class="form-label">Component Name</label>
            <input type="text" id="save-component-name-input" class="form-control" placeholder="e.g. Service Coupon Hero">
          </div>
          <div class="form-group" style="margin-top:var(--spacing-md);">
            <label class="form-label">Save In</label>
            <div id="save-component-assign-list" class="save-assign-list"></div>
          </div>
        </div>
        <div class="save-modal-footer">
          <button type="button" class="btn btn-primary flex-1" id="confirm-save-component">Save to Library</button>
          <button type="button" class="btn btn-ghost" id="cancel-save-component">Cancel</button>
        </div>
      </div>
    </div>

    <script type="module" src="./index.tsx"></script>
  </body>
</html>
